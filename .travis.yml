language: python

stages:
  - lint
  - test

python:
  - "3.6"
  - "3.7-dev"
  - "nightly"

install:
  - curl -sSL https://raw.githubusercontent.com/sdispater/poetry/master/get-poetry.py | python
  - git clone -b rewrite https://github.com/Rapptz/discord.py.git ./vendor/discord.py
  - poetry install -v

script:
  - python -m pytest --cov=hugo

after_success:
  - codecov

jobs:
  include:
    - stage: lint
      install:
        - pip install pre-commit
        - pre-commit install-hooks
      script:
        - pre-commit run --all-files

matrix:
  fast_finish: true
  allow_failures:
  - python: "nightly"
